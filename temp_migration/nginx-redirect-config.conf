# Nginx configuration for redirecting OBP-API paths to OBP-Portal paths
# This configuration should be included in your main nginx configuration
# Replace $OBP_PORTAL_HOST with your actual OBP-Portal hostname

# Define the OBP Portal upstream (adjust as needed)
# upstream obp_portal {
#     server localhost:3000;
# }

# Redirect rules for OBP-API to OBP-Portal
# Place these rules in your server block that handles the OBP-API domain

# ============================================================================
# Direct Equivalents - Pages with clear 1:1 mapping
# ============================================================================

# Home pages -> root
location = /index {
    return 301 $scheme://$OBP_PORTAL_HOST/;
}

location = /index-en {
    return 301 $scheme://$OBP_PORTAL_HOST/;
}

# User information and management
location = /user-information {
    return 301 $scheme://$OBP_PORTAL_HOST/user;
}

# Consents management
location = /consents {
    return 301 $scheme://$OBP_PORTAL_HOST/user/consents;
}

# User invitation pages (all variants go to main invitation page)
location = /user-invitation {
    return 301 $scheme://$OBP_PORTAL_HOST/user-invitation;
}

location = /user-invitation-info {
    return 301 $scheme://$OBP_PORTAL_HOST/user-invitation;
}

location = /user-invitation-invalid {
    return 301 $scheme://$OBP_PORTAL_HOST/user-invitation;
}

location = /user-invitation-warning {
    return 301 $scheme://$OBP_PORTAL_HOST/user-invitation;
}

# OAuth and consent screens -> login flow
location = /oauth/authorize {
    return 301 $scheme://$OBP_PORTAL_HOST/login;
}

location = /consent {
    return 301 $scheme://$OBP_PORTAL_HOST/login;
}

location = /consent-screen {
    return 301 $scheme://$OBP_PORTAL_HOST/login;
}

# Consumer management (admin -> user-scoped)
location = /admin/consumers {
    return 301 $scheme://$OBP_PORTAL_HOST/user/consumers;
}

# ============================================================================
# Partial Equivalents - Pages with similar functionality
# ============================================================================

# SDKs and introduction pages -> about page
location = /sdks {
    return 301 $scheme://$OBP_PORTAL_HOST/about;
}

location = /introduction {
    return 301 $scheme://$OBP_PORTAL_HOST/about;
}

# Debug awake page -> status page
location = /debug/awake {
    return 301 $scheme://$OBP_PORTAL_HOST/status;
}

# ============================================================================
# No Direct Equivalent - Redirect to Portal root or preserve path
# ============================================================================

# Static content page - preserve path and proxy to portal
location = /static {
    proxy_pass $scheme://$OBP_PORTAL_HOST/static;
}

# Terms and Conditions - preserve path
location = /terms-and-conditions {
    proxy_pass $scheme://$OBP_PORTAL_HOST/terms-and-conditions;
}

# Privacy Policy - preserve path
location = /privacy-policy {
    proxy_pass $scheme://$OBP_PORTAL_HOST/privacy-policy;
}

# Already logged in page - redirect to user page
location = /already-logged-in {
    return 301 $scheme://$OBP_PORTAL_HOST/user;
}

# OTP validation - redirect to login (not yet implemented)
location = /otp {
    return 301 $scheme://$OBP_PORTAL_HOST/login;
}

# Dummy user tokens - redirect to user consumers page (closest equivalent)
location = /dummy-user-tokens {
    return 301 $scheme://$OBP_PORTAL_HOST/user/consumers;
}

# Sandbox account creation - redirect to register (closest equivalent)
location = /create-sandbox-account {
    return 301 $scheme://$OBP_PORTAL_HOST/register;
}

# ============================================================================
# Berlin Group Consent Pages - Not yet implemented in Portal
# ============================================================================

# Berlin Group consent requests - redirect to root with notice
location ~ ^/confirm-bg-consent-request {
    return 302 $scheme://$OBP_PORTAL_HOST/?notice=berlin_group_consent;
}

# ============================================================================
# VRP Consent Pages - Not yet implemented in Portal
# ============================================================================

# VRP consent pages - redirect to root with notice
location ~ ^/confirm-vrp-consent {
    return 302 $scheme://$OBP_PORTAL_HOST/?notice=vrp_consent;
}

# ============================================================================
# User Auth Context Updates - Not yet implemented in Portal
# ============================================================================

# User auth context update requests - redirect to user page
location ~ ^/(add|confirm)-user-auth-context-update-request$ {
    return 301 $scheme://$OBP_PORTAL_HOST/user;
}

# ============================================================================
# Debug Pages - Development only, redirect to status
# ============================================================================

# All debug pages redirect to status page
location ~ ^/debug/ {
    return 301 $scheme://$OBP_PORTAL_HOST/status;
}

location = /debug {
    return 301 $scheme://$OBP_PORTAL_HOST/status;
}

# ============================================================================
# OAuth callback handling
# ============================================================================

# OAuth thanks page - redirect to user page
location = /oauth/thanks {
    return 301 $scheme://$OBP_PORTAL_HOST/user;
}

# ============================================================================
# Fallback for any other paths
# ============================================================================

# If you want to catch all other paths and redirect to portal root:
# location / {
#     return 301 $scheme://$OBP_PORTAL_HOST$request_uri;
# }

# ============================================================================
# Example server block usage:
# ============================================================================
#
# server {
#     listen 80;
#     server_name old-api.example.com;
#
#     # Set the portal host variable
#     set $OBP_PORTAL_HOST portal.example.com;
#
#     # Include this configuration file
#     include /path/to/nginx-redirect-config.conf;
#
#     # Handle remaining requests to actual API
#     location / {
#         proxy_pass http://obp_api_backend;
#     }
# }
#
# ============================================================================